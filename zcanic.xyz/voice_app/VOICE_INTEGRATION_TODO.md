# Zcanic Voice Service 网站集成 TODO

本文档详细列出了将 Zcanic Voice Service 与现有网站进行集成的详细计划和执行顺序。

## 优先级说明

- 🔴 高优先级（必须完成）
- 🟠 中优先级（重要但可延后）
- 🟢 低优先级（增强功能）

## 1. 基础部署（第 1-5 天）

### 1.1 语音服务部署 🔴

- [ ] 在生产服务器上安装 Python 3.8+ 环境
- [ ] 运行 `voice_app/scripts/setup_environment.sh` 配置环境
- [ ] 配置 `.env` 文件，添加必要的 API 密钥和设置
- [ ] 使用 `voice_app/scripts/deploy_service.py` 部署为系统服务
- [ ] 测试语音服务是否正常运行（使用 `test_client.py`）

### 1.2 Nginx 反向代理配置 🔴

- [ ] 为语音服务配置反向代理，添加以下路径映射：
  ```
  /voice-api/ -> http://localhost:8000/api/
  /voice-audio/ -> http://localhost:8000/audio_storage/
  ```
- [ ] 配置 CORS 和缓存策略
- [ ] 测试通过反向代理访问服务

### 1.3 安全配置 🔴

- [ ] 在 `config_local.yaml` 中设置 API 密钥
- [ ] 配置允许的 CORS 来源（限制为网站域名）
- [ ] 确保音频目录权限设置正确

## 2. 前端集成（第 6-12 天）

### 2.1 基础集成组件开发 🔴

- [ ] 在 `src/components/voice` 目录下创建 `VoicePlayer.jsx` 组件
- [ ] 实现基本的 TTS 请求和音频播放功能
- [ ] 添加加载状态和错误处理

### 2.2 API 服务集成 🔴

- [ ] 在 `src/services/api.js` 中添加语音服务 API 方法
  ```javascript
  voice: {
    tts: (text, speakerId) => { /* 实现 */ },
    getSpeakers: () => { /* 实现 */ }
  }
  ```
- [ ] 添加错误处理和重试机制

### 2.3 聊天功能集成 🟠

- [ ] 修改 `src/components/chat/MessageItem.jsx`，为 AI 消息添加语音播放功能
- [ ] 实现播放状态管理和视觉反馈

### 2.4 用户设置集成 🟠

- [ ] 在用户设置中添加语音相关选项（开启/关闭、说话人选择）
- [ ] 实现设置的本地存储

### 2.5 UI/UX 设计优化 🟠

- [ ] 确保语音控件与现有磨砂玻璃设计风格一致
- [ ] 创建符合网站设计语言的播放状态动画
- [ ] 优化移动端显示和交互

## 3. 后端集成（第 13-17 天）

### 3.1 代理 API 端点（可选）🟠

- [ ] 在 `server/routes` 创建 `voice.js` 路由
- [ ] 实现 TTS 请求的代理转发
- [ ] 添加用户认证和请求日志

### 3.2 聊天功能增强 🔴

- [ ] 修改 `server/controllers/ai.js`，在 AI 响应中添加语音支持标记
- [ ] 优化消息存储结构，支持语音相关元数据

### 3.3 用户配置存储 🟢

- [ ] 创建数据库表存储用户语音偏好
- [ ] 实现用户语音设置的 API 端点

## 4. 性能优化与监控（第 18-21 天）

### 4.1 缓存优化 🟠

- [ ] 前端实现已播放音频的缓存机制
- [ ] 调整语音服务缓存策略，优化存储使用

### 4.2 懒加载优化 🟢

- [ ] 实现语音组件按需加载
- [ ] 预加载策略（可选）

### 4.3 监控系统 🟠

- [ ] 集成基本监控指标（请求量、成功率、响应时间）
- [ ] 配置错误告警
- [ ] 创建监控仪表板

## 5. 测试与质量保证（贯穿全程）

### 5.1 单元测试 🔴

- [ ] 为核心组件编写单元测试
- [ ] 测试各种错误场景和边缘情况

### 5.2 集成测试 🔴

- [ ] 测试完整的语音生成和播放流程
- [ ] 测试高并发和性能边界

### 5.3 用户测试 🟠

- [ ] 进行内部用户测试，收集反馈
- [ ] 基于反馈进行迭代优化

## 6. 文档与上线准备（最后 3 天）

### 6.1 使用文档 🟠

- [ ] 编写用户指南，说明如何使用语音功能
- [ ] 创建管理员文档，包含维护和故障排除说明

### 6.2 最终检查 🔴

- [ ] 全面测试所有功能点
- [ ] 性能和安全最终审查

### 6.3 正式上线 🔴

- [ ] 分阶段部署到生产环境
- [ ] 监控系统运行情况
- [ ] 收集初期用户反馈

## 执行顺序摘要

1. 🔴 基础部署配置（确保语音服务在生产环境正常运行）
2. 🔴 前端和后端的核心集成开发（实现基本功能）
3. 🟠 提升用户体验（UI/UX 优化、设置等）
4. 🟠 性能优化与监控
5. 🟠 测试和文档
6. 🔴 最终检查与上线

## 注意事项

1. **依赖管理**：确保所有依赖版本兼容，尤其是前端库
2. **错误隔离**：语音服务的任何故障不应影响网站核心功能
3. **资源使用**：定期监控服务器资源使用情况，尤其是长时间运行后
4. **用户反馈**：建立有效的反馈渠道，及时调整和优化功能

## 定期回顾与调整

- 每周回顾进度并调整计划
- 记录遇到的问题和解决方案，更新到文档中
- 随时根据用户反馈和性能数据调整优先级
